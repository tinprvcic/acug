<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./shared/head') -%>
    <link rel="stylesheet" href="/order.css" />
  </head>

  <body>
    <%- include('./shared/nav_header') -%>

    <div class="main-content">
      <div class="title-row">
        <h1>Narudžba #<%= order.order_id %></h1>

        <form action="/orders/<%= order.order_id  %>/delete" method="post" ><input type="submit" value="Obriši narudžbu"></form>
      </div>

      <form action="/orders/<%= order.order_id %>" method="post" class="form">
        <div class="form-item">
          <label>Stol:</label>
          <select name="table" id="table">
            <% tables.forEach(t => { %>
            <option
              value="<%= t.id %>"
              <%= order.table_id === t.id ? "selected" : "" %>
            >
              <%= t.name %>
            </option>
            <% }); %>
          </select>
        </div>

        <div class="form-item">
          <label>Status:</label>
          <select name="status" id="status">
            <option value="pending" 
            <%= order.status === "pending" ? "selected" : "" %>
              >Neispunjena</option>
            <option value="delivered" 
            <%= order.status === "delivered" ? "selected" : "" %>
            >Isporučena</option>
            <option value="canceled" 
            <%= order.status === "canceled" ? "selected" : "" %>
            >Otkazana</option>
          </select>
        </div>
          <input type="submit" value="Spremi izmjene" />
      </form>

        <h3>Naručeni artikli</h3>
        <div>
              <% order.articles.forEach((a) => { %>
                <p><%= a.article_name %> - <%= (a.article_price / 100).toFixed(2) %>x<%= a.quantity %> - <%= (a.quantity * a.article_price / 100).toFixed(2) %></p>

              <form action="/orders/<%= order.order_id %>/remove" method="post"<%= a.article_id %>">
                <input type="hidden" name="article" value="<%= a.article_id %>">
                <input type="submit" value="Ukloni">
              </form>
                <div id="<%= a.article_id %>">
                <input type="button" value="Uredi" onclick="replaceArticleWidthEditable(<%= order.order_id %>,<%= a.article_id %>);">
                </div>
              <% }); %>
              </div>
        
        <h3>Dodaj novi artikl</h3>
        <form action="/orders/<%= order.order_id %>/add" method="post" class="add-more-form">
          <div class="add-more-section">
            <label for="article">Artikl:</label>

            <select name="article" id="article">
              <% articles.forEach(a => { %>
              <option value="<%= a.id %>"><%= a.name %></option>
              <% }); %>
            </select>
          </div>

          <div class="add-more-section">
            <label for="qyt">Količina</label>
            <input type="number" name="qyt" id="qyt" value="1" required />
          </div>

          <input type="submit" value="Dodaj" />
        </form>
    </div>
    
    <script>
      function replaceArticleWidthEditable(order_id, id) {
        const html = `
          <form action="/orders/${order_id}/quantity" method="post">
            Nova kol.<input type="number" value="0" name="qyt"/>
            <input type="hidden" name="article" value="${id}" />
            <input type="submit" value="Spremi" />
          </form>
        `
        
        document.getElementById(id).innerHTML = html;
      }
    </script>

  </body>
</html>
